app-id: com.gnome.dataguardian
runtime: org.gnome.Platform
runtime-version: "48"
sdk: org.gnome.Sdk
command: dataguardian.sh

finish-args:
  - --share=ipc
  - --device=all
  - --socket=x11
  - --socket=wayland
  - --filesystem=host
  - --filesystem=home
  - --share=network
  - --socket=session-bus  
  - --talk-name=org.freedesktop.Flatpak
  - --filesystem=xdg-run/flatpak
  - --filesystem=xdg-run/gvfsd

modules:
  - name: dataguardian
    buildsystem: simple
    sources:
      - type: git
        url: https://github.com/GeovaneJefferson/dataguardian.git
        branch: main
      - type: file
        path: com.gnome.dataguardian.metainfo.xml
      - type: file
        path: data/icons/com.gnome.dataguardian.png

    build-commands:
      # Create main app directory
      - mkdir -p /app/share/dataguardian

      # Copy source and data
      - cp -r src /app/share/dataguardian
      - cp -r data /app/share/dataguardian
      - cp -r share /app/share/dataguardian

      # Install .desktop file
      - mkdir -p /app/share/applications
      - cp share/applications/com.gnome.dataguardian.desktop /app/share/applications/

      # Install icon (128x128 recommended for modern desktops)
      - mkdir -p /app/share/icons/hicolor/128x128/apps
      - cp data/icons/com.gnome.dataguardian.png /app/share/icons/hicolor/128x128/apps/

      # Optionally install to 48x48 for legacy support
      - mkdir -p /app/share/icons/hicolor/48x48/apps
      - cp data/icons/com.gnome.dataguardian.png /app/share/icons/hicolor/48x48/apps/

      # Install AppStream metadata
      - mkdir -p /app/share/metainfo
      - cp com.gnome.dataguardian.metainfo.xml /app/share/metainfo/

      # Install shell scripts
      - install -D -m755 dataguardian.sh /app/bin/dataguardian.sh
      - install -D -m755 stop-daemon.sh /app/bin/stop-daemon.sh

      # Create config directory
      - mkdir -p /app/share/dataguardian/config

      # Install Python dependencies
      - pip3 install --prefix=/app -r requirements.txt

    build-options:
      build-args:
        - --share=network

# Optionally, add cleanup-commands if needed
# cleanup-commands:
#   - /app/bin/stop-daemon.sh